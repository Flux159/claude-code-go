# Claude Code Go

This document serves as a guide for understanding and developing the Claude Code Go application.

## Application Architecture

Claude Code Go is a mobile application that provides a chat interface to Claude AI. The architecture consists of three main components that need to run simultaneously:

1. **Mobile App (Expo/React Native)** - `npm run start`

   - Chat UI with conversation history
   - Settings for server connection
   - Renders Claude's responses and tool calls

2. **Python Server** - `npm run server`

   - Runs on port 8142 (internally)
   - Proxies requests to the Claude CLI
   - Uses Server-Sent Events (SSE) for streaming responses
   - Executes Claude CLI commands with proper environment
   - Directory browsing and file operations

3. **Next.js Web App** - `npm run dev`
   - Runs on port 3000
   - Provides a web preview interface
   - May be used for additional features

## Development Setup

1. **Prerequisites**

   - Ensure Claude CLI is installed and configured
   - You must run `claude --dangerously-skip-permissions` in your terminal first and accept it
   - Node.js and npm installed
   - Python 3.x installed

2. **Installation**

   ```bash
   npm install
   ```

3. **Running the Application**
   Start all three components in separate terminal windows:
   ```bash
   npm run start  # Expo app
   npm run server # Python server
   npm run dev    # Next.js web app
   ```

4. **Hot Reloading**
   All components support hot reloading for easier development:
   - **Expo App**: Changes to React Native files are automatically applied
   - **Python Server**: Flask is configured with hot reloading enabled
   - **Next.js App**: Supports Fast Refresh for real-time updates

   Hot reloading means you typically don't need to restart these servers when making code changes.

## Key Files

- `/app/(tabs)/index.tsx` - Main chat UI
- `/components/ChatInput.tsx` - Chat input and message handling
- `/components/ChatMessage.tsx` - Message rendering and formatting
- `/contexts/AppContext.tsx` - State management and data model
- `/server/main.py` - Python server implementation
- `/claude-next-app/src/app/page.tsx` - Next.js web interface

## Troubleshooting

1. **Runtime Errors in Next.js App**

   - The app includes automated error reporting from Next.js to Claude
   - JavaScript errors are automatically captured and sent to the Python server
   - These errors are then included in the next prompt to Claude
   - Claude will analyze and fix these errors in its response
   - You can also manually check the terminal running `npm run dev` for errors
   - Look for errors in browser console (F12 developer tools)

2. **Connection Issues**

   - Ensure all three components are running
   - Check that hostname/port settings match in settings
   - Verify Claude CLI is properly installed and configured

3. **Claude Command Issues**
   - Run `claude --dangerously-skip-permissions` in terminal first
   - Ensure Python environment has necessary permissions
   - Check server logs for Claude CLI errors

## Error Handling System

The application includes an automated error handling system that:

1. **Captures errors** in the Next.js application using:
   - React ErrorBoundary for component errors
   - Global error listeners for unhandled errors
   - Console error overrides to capture console.error calls

2. **Reports errors** to the Python server via the `/report-error` endpoint
   - Errors are stored in a queue (max 10 errors)
   - Error data includes message, stack trace, and component info

3. **Includes errors in Claude prompts**
   - When a new prompt is sent to Claude, any stored errors are automatically included
   - Errors are formatted for Claude to analyze and provide fixes
   - The error queue is cleared after being included in a prompt

### Testing the Error Handling System

To test the automatic error handling:

1. Start all three components (Expo app, Python server, Next.js app)
2. Open the Next.js app in a browser at http://localhost:3000
3. Click on the "Test Error Handling" button
4. On the test page, click any of the error buttons to trigger different types of errors
5. Check the Python server console to confirm errors were received
6. In the Claude Go app, send any message to Claude
7. Claude should receive the errors and include fixes in its response

The test page can generate several types of errors:
- Runtime JavaScript errors
- React rendering errors
- Console error messages
- Unhandled promise rejections

## Claude CLI Notes

The app communicates with Claude via the Claude CLI tool. When you're trying to debug issues:

- Check command format: The app runs `claude -p --dangerously-skip-permissions --output-format "stream-json" "{command}"`
- To see runtime errors from websites or code generated by Claude, you'll need to:
  1. Capture the errors from your browser console
  2. Provide them to Claude through the chat interface
  3. Ask Claude to analyze and fix the errors

## Implementation Details

- SSE (Server-Sent Events) is used for streaming responses from Claude
- Messages are stored in memory (no persistence between app restarts)
- The Python server handles spawning Claude CLI processes and capturing outputs
